<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Conjuntos Din√¢micos</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">

</head>
<body>

  <h2>Escolha o nome do conjunto:</h2>
  
  <form id="nome_contagem">
    <label for="fname">Nome:</label>
    <input type="text" id="titulo" name="titulo" required>
    <input type="submit" value="OK">
  </form>

<div id="cards-container">
  {% for conjunto in conjuntos %}
    <div class="card" onclick="window.location.href='/conjuntos/{{ conjunto.titulo | urlencode }}'">
      {{ conjunto.titulo }}
    </div>
  {% endfor %}
</div>

  <script>
    //document faz referencia ao html da pagina
    const form = document.getElementById("nome_contagem");
    const input = document.getElementById("titulo");
    const container = document.getElementById("cards-container");

    form.addEventListener("submit", async (event) => 
    {
      event.preventDefault();
      const nome = input.value.trim();
      if (nome === "")
      { 
        return;
      }
      
      // Envia para o Flask via fetch
      const resposta = await fetch("/registra_conjunto", //await pra esperar a resposta da requisicao
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ titulo: nome }) //transforma os dados do js em dados json
      });

      const resultado = await resposta.json();
      if (resultado.status === "ok") 
      {
        const novoCard = document.createElement("div");
        novoCard.classList.add("card");
        novoCard.textContent = nome;
        novoCard.addEventListener("click", () => 
        {
        console.log("Card clicado:", nome);
        window.location.href = `/conjuntos/${encodeURIComponent(nome)}`; //redirect pra outra url que recebe o nome do card como parametro
        });
        container.appendChild(novoCard);
        input.value = "";
        alert(resultado.mensagem);
      } 
      else 
      {
        alert(resultado.mensagem);
      }
    });
  </script>
</body>
</html>
